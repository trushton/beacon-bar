<html>
<head>
    <title>BeaconBar</title>
    <meta charset="UTF-8">
    <script src="jquery.min.js" type="text/javascript" language="javascript"><!--jquery-ui.position--></script>
    <script src="jquery-ui.min.js" type="text/javascript" language="javascript"></script>
    <link rel="stylesheet" href="jquery-ui.min.css" type="text/css" media="all" />

    <link rel="stylesheet" href="styles.css" type="text/css" media="all" />


    <script src="https://www.gstatic.com/firebasejs/3.6.9/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCvDt__-j-koRzjvYOtlXmMjcjHrX9SPho",
            authDomain: "beaconbar-e8384.firebaseapp.com",
            databaseURL: "https://beaconbar-e8384.firebaseio.com",
            storageBucket: "beaconbar-e8384.appspot.com",
            messagingSenderId: "9892124037"
        };
        firebase.initializeApp(config);
        firebase.auth().signInWithEmailAndPassword('thomas.rushton@originate.com', 'testpass');
    </script>

</head>
  <body id="immediateDevice">

    <div id="background">
        <!-  img src="immediate.jpg"  ->
    </div>

    <div id="suggestion" style="width:100%;color:black;text-align:center">
    </div>
    <div id="notFound" style="width:100%;color:black;text-align:center">
    </div>
    <script src="newaer-immediate.js" type="text/javascript" language="javascript"></script>
    <script>
        var drinks = {
          "vodka": {
              "Walmart Blue": {
                  "name": "Walmart Blue",
                  "ingredients": ["Vodka", "Lemonade", "Blue Cuacao"]
              },
              "Moscow Mule": {
                  "name": "Moscow Mule",
                  "ingredients": ["Vodka", "Gingerbeer", "Lime"]
              },
              "Texas Sipper": {
                  "name": "Texas Sipper",
                  "ingredients": ["Vodka", "St. Germaine", "Grapefruit Juice", "Mint", "Topo Chico"]
              }
          },
          "whiskey": {
              "Walmart Yellow": {
                  "name": "Walmart Yellow",
                  "ingredients": ["Whiskey", "Sweet N Sour"],
                  "fact": "TX Blended Whiskey is made over in Fort Worth, TX"
              },
              "Texas Tea": {
                  "name": "Texas Tea",
                  "ingredients": ["Whiskey", "Sweet Tea", "Pomegranate Juice"]
              }
          },
          "beer": {
              "Shiner": {
                  "name": "Shiner",
                  "type": "dark option"
              },
              "Fireman's 4": {
                  "name": "Fireman's 4",
                  "type": "light option"
              }
          },
          "red wine": {
              "Pinot Noir": {
                  "name": "Pinot Noir",
                  "type": "Mark West"
              },
              "Merlot": {
                  "name": "Merlot",
                  "type": "Mark West"
              }
          },
          "white wine": {
              "Chenin Blanc": {
                  "name": "Chenin Blanc",
                  "type": "Llano Estacado"
          }
      };

      (function(){
          var database = firebase.database();
          var ref = database.ref('users/');
          var badgeId = localStorage.getItem("currentDevice");


          ref.once('value').then(function(snapshot) {
              if (snapshot.hasChild(badgeId)) {
                  var user = snapshot.child(badgeId);
                  var name = user.child('username').val();
                  var drink_pref = user.child('drink_pref').val();
                  var recommendation = recommendDrink(drink_pref);

                  $('#suggestion').html("<h3>Hi there " + name + ", how about a " + recommendation.name + " seeing as you like " + drink_pref + ".</h3>");

                  database.ref('users/'+badgeId).update({
                      barCount: (user.child('barCount').val()+1),
                      prevRecommendation: recommendation.name
                  });
              }
              else{
                  $('#notFound').html("<h3>I'm sorry, I don't recognize you. Perhaps you need to sign up at the registration kiosk?</h3>");
              }
          });
        })();

        function recommendDrink(preference){
            console.log(preference);
            var keys = Object.keys(drinks[preference]);
            return drinks[preference][keys[keys.length * Math.random() <<0]];
        }
    </script>
  </body>
</html>
