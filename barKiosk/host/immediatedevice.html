<html>
<head>
    <title>BeaconBar</title>
    <meta charset="UTF-8">
    <script src="jquery.min.js" type="text/javascript" language="javascript"><!--jquery-ui.position--></script>
    <script src="jquery-ui.min.js" type="text/javascript" language="javascript"></script>
    <link rel="stylesheet" href="jquery-ui.min.css" type="text/css" media="all" />

    <link rel="stylesheet" href="styles.css" type="text/css" media="all" />




    <script src="https://www.gstatic.com/firebasejs/3.6.9/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCvDt__-j-koRzjvYOtlXmMjcjHrX9SPho",
            authDomain: "beaconbar-e8384.firebaseapp.com",
            databaseURL: "https://beaconbar-e8384.firebaseio.com",
            storageBucket: "beaconbar-e8384.appspot.com",
            messagingSenderId: "9892124037"
        };
        firebase.initializeApp(config);
        firebase.auth().signInWithEmailAndPassword('thomas.rushton@originate.com', 'testpass');
    </script>

</head>
  <body id="immediateDevice">

    <div id="background">
        <!-  img src="immediate.jpg"  ->
    </div>

    <div id="suggestion" style="width:100%;color:black;text-align:center">
    </div>
    <p>THis is a test</p>
    <script src="newaer-immediate.js" type="text/javascript" language="javascript"></script>
    <script>
        var drinks = {
          "Vodka": {
              "Walmart Blue": {
                  "ingredients": ["Vodka", "Lemonade", "Blue Cuacao"],
                  "fact": "Tito's Vodka is made close by in Austin, TX"
              },
              "Moscow Mule": {
                  "ingredients": ["Vodka", "Gingerbeer", "Lime"],
                  "fact": "Tito's Vodka is made close by in Austin, TX"
              },
              "Texas Sipper": {
                  "ingredients": ["Vodka", "St. Germaine", "Grapefruit Juice", "Mint", "Topo Chico"],
                  "fact": "Tito's Vodka is made close by in Austin, TX"
              }
          },
          "Whiskey": {
              "Walmart Yellow": {
                  "ingredients": ["Whiskey", "Sweet N Sour"],
                  "fact": "TX Blended Whiskey is made over in Fort Worth, TX"
              },
              "Texas Tea": {
                  "ingredients": ["Whiskey", "Sweet Tea", "Pomegranate Juice"],
                  "fact": "TX Blended Whiskey is made over in Fort Worth, TX"
              }
          },
          "Beer": {
              "Shiner": {
                  "type": "dark option",
                  "fact": "Shiner is brewed in Shiner, TX"
              },
              "Fireman's 4": {
                  "type": "light option",
                  "fact": "Fireman's 4 is brewed in Blanco, TX"
              }
          },
          "Red Wine": {
              "Pinot Noir": {
                  "type": "Mark West",
                  "fact": 'COME UP WITH SOMETHING'
              },
              "Merlot": {
                  "type": "Mark West",
                  "fact": 'COME UP WITH SOMETHING'
              }
          },
          "White Wine": {
              "Chenin Blanc": {
                  "type": "Llano Estacado",
                  "fact": 'COME UP WITH SOMETHING'
              }
          }
      };

      (function(){
          var database = firebase.database();
          var ref = database.ref('users/');
          var badgeId = localStorage.getItem("currentDevice");


          ref.once('value').then(function(snapshot) {
              if (snapshot.hasChild(badgeId)) {
                  console.log('needs to be fixed');
                  var user = snapshot.child(badgeId);
                  var name = user.child('username').val();
                  var drink_pref = user.child('drink_pref').val();
                  var recommendation = recommendDrink(drink_pref);
                  console.log(recommendation);

                  $('#suggestion').html("<h3>Hi there " + name + ", I'd recommend the " + recommendation.name + " seeing as you like " + drink_pref + ".</h3>" +
                      "<h4>Fun fact: " + recommendation.fact + ".</h4>");

                  return recommendation;
                 // database.ref(badgeId).update({
                 //     barCount: (user.child('barCount')+1),
                 //     prevRecommendation: recommendation.name
                 // });
              }
              else{
                  $('#notFound').html("<h3>I'm sorry, I don't recognize you. Perhaps you need to sign up at the registration kiosk?</h3>");
              }
          });
        })();

        function recommendDrink(preference){
            var keys = Object.keys(drinks[preference]);
            return drinks[preference[keys[keys.length * Math.random() <<0]]];
        }
    </script>
  </body>
</html>
